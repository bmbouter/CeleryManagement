

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Policies Overview &mdash; CeleryManagement v0.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CeleryManagement v0.0 documentation" href="../index.html" />
    <link rel="up" title="Policies" href="index.html" />
    <link rel="next" title="Policies API" href="api.html" />
    <link rel="prev" title="Policies" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api.html" title="Policies API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Policies"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CeleryManagement v0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Policies</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="policies-overview">
<h1>Policies Overview<a class="headerlink" href="#policies-overview" title="Permalink to this headline">¶</a></h1>
<p>Policies are designed to allow some automatic management of Celery workers.
When a policy is executed, they first check to see if a condition is true.  If
it is, then the body of the policy is executed.  Within the body, various
Worker and Task attributes can be modified.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Policies run outside of Celery.  You may alter worker and task
settings without worrying how it will affect your currently-running policy.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The compulsory Hello World example:</p>
<div class="highlight-python"><pre>policy:
    schedule:
        crontab()
    condition:
        True
    apply:
        print "hello world!"</pre>
</div>
<p>This will simply print &#8220;hello world!&#8221; every minute.  However, it illustrates
the three sections of a policy: the schedule, condition, and apply.  The
schedule determines when a policy is run.  The condition determines if the
apply section is run.  And the apply section is the body of the policy—where
Celery Task and Worker settings may be modified.</p>
<p>The schedule section must be an expression that returns an object that
implements the Celery <tt class="docutils literal"><span class="pre">schedule</span></tt> interface.  Currently, the only available
schedule type is <tt class="docutils literal"><span class="pre">crontab</span></tt>, which is provided by Celery and permits cron-like
scheduling.  With no arguments, it defaults to running every minute.</p>
<p>The condition section determines if the apply section should be executed.  If
it evaluates to <tt class="xref docutils literal"><span class="pre">True</span></tt>, the apply is run, otherwise it is not.  It is
optional—when not supplied the apply section is run every time.</p>
<p>The apply section is the body of the policy—it is where Worker and Task
settings may be modified.</p>
</div>
<div class="section" id="features-limitations">
<h2>Features &amp; Limitations<a class="headerlink" href="#features-limitations" title="Permalink to this headline">¶</a></h2>
<p>TODO....</p>
<p>Not permitted in any section:</p>
<ul class="simple">
<li>imports</li>
<li>defining functions (with <tt class="docutils literal"><span class="pre">def</span></tt> or with <tt class="docutils literal"><span class="pre">lambda</span></tt>)</li>
<li>defining classes</li>
<li><tt class="docutils literal"><span class="pre">exec</span></tt> statement or <tt class="docutils literal"><span class="pre">eval()</span></tt> function</li>
<li>any name beginning with an underscore (this hides implementation details)</li>
<li>selected built-in functions and types</li>
</ul>
<p>Not permitted in the <tt class="docutils literal"><span class="pre">schedule</span></tt> or <tt class="docutils literal"><span class="pre">condition</span></tt> sections:</p>
<ul class="simple">
<li>assignment (these sections must be expressions)</li>
<li>deletion (the <tt class="docutils literal"><span class="pre">del</span></tt> keyword)</li>
</ul>
<p>These limitations keep policies focused and simple.</p>
</div>
<div class="section" id="sections">
<h2>Sections<a class="headerlink" href="#sections" title="Permalink to this headline">¶</a></h2>
<p>A Policy is made up of three sections: Schedule, Condition and Apply.</p>
<div class="section" id="schedule">
<h3>Schedule<a class="headerlink" href="#schedule" title="Permalink to this headline">¶</a></h3>
<p>The Schedule section determines when and/or how frequently a policy is
executed.  The schedule section is required.</p>
<p>TODO....</p>
</div>
<div class="section" id="condition">
<h3>Condition<a class="headerlink" href="#condition" title="Permalink to this headline">¶</a></h3>
<p>The condition section is what determines whether the apply section will be run.
The idea being that policies follow a simple if...then structure:
if&nbsp;``condition``&nbsp;then&nbsp;``apply``.</p>
<p>Some key points about conditions:</p>
<ul class="simple">
<li>They are optional.  A non-existent condition is equivalent to a
condition that always evaluates to True.</li>
<li>They must be simple.  Statements are not permitted—it must be an
expression.</li>
<li>If there are multiple condition sections, the results are effectively ORed
together.  In other words, if any single condition evaluates to True, the
apply section is run.</li>
<li>Multiple lines in a single condition are ANDed together.  In other words, all
lines in a condition must be true for the condition as a whole to evaluate to
True.  (You can work around this using the usual Python line continuation
techniques: a backslash or wrapping it in parentheses.)</li>
</ul>
<p>TODO....</p>
</div>
<div class="section" id="apply">
<h3>Apply<a class="headerlink" href="#apply" title="Permalink to this headline">¶</a></h3>
<p>The apply section is the body of the policy.  It is where the behavior of
Celery can be modified.  The apply section is required.</p>
<p>TODO....</p>
</div>
</div>
<div class="section" id="policy-manager">
<h2>Policy Manager<a class="headerlink" href="#policy-manager" title="Permalink to this headline">¶</a></h2>
<p>The Policy Manager is the process that executes the policies.  There are two
ways to run it: directly using <tt class="docutils literal"><span class="pre">cmpolicy</span></tt> or as part of <tt class="docutils literal"><span class="pre">cmrun</span></tt>.</p>
<p>TODO....</p>
</div>
<div class="section" id="common-issues">
<h2>Common Issues<a class="headerlink" href="#common-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The Policy Manager must be running.</li>
<li>It must have access to the django database where Dispatched Task status is
recorded.</li>
<li>Celery workers must have access to the CeleryManagementLib package.  (Usually this means installing it on the worker&#8217;s (virtual) machine.)</li>
<li>Exceptions:<ul>
<li>Syntax Errors found while compiling a policy are displayed through the web
interface.</li>
<li>Exceptions thrown while a policy is executing are generally handled by the
Policy Manager.  It will write them to the logger, which by default is
stdout.</li>
<li>Exceptions thrown from within a Celery worker (while reading or writing
task or worker settings) are handled before returning to the Policy
Manager.  In such cases, it is probably best to consult both the celeryd
and Policy Manager logs.</li>
</ul>
</li>
</ul>
<p>TODO....</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Policies Overview</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#features-limitations">Features &amp; Limitations</a></li>
<li><a class="reference internal" href="#sections">Sections</a><ul>
<li><a class="reference internal" href="#schedule">Schedule</a></li>
<li><a class="reference internal" href="#condition">Condition</a></li>
<li><a class="reference internal" href="#apply">Apply</a></li>
</ul>
</li>
<li><a class="reference internal" href="#policy-manager">Policy Manager</a></li>
<li><a class="reference internal" href="#common-issues">Common Issues</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Policies</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">Policies API</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/policy/overview.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="api.html" title="Policies API"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Policies"
             >previous</a> |</li>
        <li><a href="../index.html">CeleryManagement v0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Policies</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, ITng Services.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>